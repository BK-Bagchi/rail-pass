<form action="/booking/checkTrainList" method="POST" class="p-4 shadow rounded bg-light" style="max-width: 500px; margin: auto;">
  <h3 class="mb-4 text-center">Book Your Ticket</h3>

  <!-- From Station -->
  <div class="mb-3">
    <label for="fromStation" class="form-label fw-bold">From Station</label>
    <input type="text" class="form-control" id="fromStation" name="fromStation" placeholder="Select Departure Station" data-bs-toggle="modal" data-bs-target="#stationModal" onclick="setActiveField('fromStation')" readonly required>
  </div>

  <!-- To Station -->
  <div class="mb-3">
    <label for="toStation" class="form-label fw-bold">To Station</label>
    <input type="text" class="form-control" id="toStation" name="toStation" placeholder="Select destination station" data-bs-toggle="modal" data-bs-target="#stationModal" onclick="setActiveField('toStation')" readonly required>
  </div>

  <div class="mb-3">
    <label for="seatClass" class="form-label fw-bold">Seat Class</label>
    <select class="form-select" id="seatClass" name="seatClass" required>
      <option value="" class="d-none">Select seat class</option>
      <option value="AC_Sleeper">AC_Sleeper</option>
      <option value="AC_Chair">AC_Chair</option>
      <option value="AC_Seat">AC_Seat</option>
      <option value="First_Sleeper">First_Sleeper</option>
      <option value="First_Chair">First_Chair</option>
      <option value="First_Seat">First_Seat</option>
      <option value="General">General</option>
    </select>
  </div>

  <div class="mb-3">
    <label for="journeyDate" class="form-label fw-bold">Journey Date</label>
    <input type="date" class="form-control" id="journeyDate" name="journeyDate" required>
  </div>

  <div class="d-grid">
    <button type="submit" class="btn btn-primary w-100">Book Now</button>
    <% if(!login) {%>
      <br>
      <p class="text-danger text-center"><a href="/auth/login"> Login to Book Ticket</a></p>
    <% } %>
  </div>
</form>

<!-- Search Station Modal -->
<div class="modal fade" id="stationModal" tabindex="-1" aria-labelledby="stationModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="stationModalLabel">Select Station</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <input type="text" class="form-control mb-3" id="stationSearch" placeholder="Search station...">

        <!-- Station List (empty at start) -->
        <ul class="list-group" id="stationList" style="max-height: 300px; overflow-y: auto;"></ul>
      </div>
    </div>
  </div>
</div>


<script>
  const stations = <%- JSON.stringify(stations) %>; // Pass all stations from backend
  let activeField = null;

  // Track active input (from / to)
  function setActiveField(fieldId) {
    activeField = fieldId;
  }

  // Search & populate results
  document.getElementById("stationSearch").addEventListener("input", function () {
    let query = this.value.toLowerCase();
    let list = document.getElementById("stationList");
    list.innerHTML = ""; // Clear old results

    if (query.length === 0) return; // Don't show anything until typing starts

    let filtered = stations.filter(st => st.stationName.toLowerCase().includes(query));

    if (filtered.length === 0) {
      list.innerHTML = `<li class="list-group-item text-muted">No station found</li>`;
    } else {
      filtered.forEach(st => {
        let li = document.createElement("li");
        li.className = "list-group-item station-item";
        li.textContent = st.stationName;

        li.addEventListener("click", function () {
          if (activeField) {
            document.getElementById(activeField).value = st.stationName;
          }
          let modal = bootstrap.Modal.getInstance(document.getElementById("stationModal"));
          modal.hide();
        });

        list.appendChild(li);
      });
    }
  });

  //Makes the date input field only allow today to future 15 day dates
  const journeyDateInput = document.getElementById("journeyDate");
  const today = new Date();
  const dd = String(today.getDate()).padStart(2, '0');
  const mm = String(today.getMonth() + 1).padStart(2, '0'); // January is 0
  const yyyy = today.getFullYear();

  const minDate = `${yyyy}-${mm}-${dd}`;

  const maxDateObj = new Date();
  maxDateObj.setDate(today.getDate() + 15);
  const ddMax = String(maxDateObj.getDate()).padStart(2, '0');
  const mmMax = String(maxDateObj.getMonth() + 1).padStart(2, '0');
  const yyyyMax = maxDateObj.getFullYear();
  const maxDate = `${yyyyMax}-${mmMax}-${ddMax}`;

  journeyDateInput.setAttribute("min", minDate);
  journeyDateInput.setAttribute("max", maxDate);
</script>


